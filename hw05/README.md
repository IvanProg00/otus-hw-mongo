# Шардированный кластер

## Цель

- В результате выполнения ДЗ вы настроите реплицирование и шардирование, аутентификацию в кластере и проверите отказоустойчивость.

## Описание/Пошаговая инструкция выполнения домашнего задания

### Необходимо

- построить шардированный кластер из 3 кластерных нод( по 3 инстанса с репликацией) и с кластером конфига(3 инстанса);
- добавить балансировку, нагрузить данными, выбрать хороший ключ шардирования, посмотреть как данные перебалансируются между шардами;
- настроить аутентификацию и многоролевой доступ;
- поронять разные инстансы, посмотреть, что будет происходить, поднять обратно. Описать что произошло.

### Формат сдачи - readme с описанием алгоритма действий, результатами и проблемами

- реализовать бэкап шардированного кластера
- \* реализовать бэкап шардированного кластера на ванильной Монго, желательно под нагрузкой и проверить восстановление из бэкапа
- ** реализовать PITR бэкап шардированного кластера на ванильной Монго, желательно под нагрузкой и проверить восстановление из бэкапа

---

## Действия

1. Сначало я создал в `GCP` 3 инстанса.
2. В каждый инстанс я установил `Mongo` и запустил его.
3. Создал 3 шардированных репликасет и три реплики конфига.
4. Проинициалазировал с помощью команды `rs.initiate`.
5. Создаём шардированный кластер с помощью mongos (--bind_ip_all я использовал чтобы не париться с ip).
6. Взял данные и отправил их в базу данных.
7. Разрешил Mongo создавать шарды над данной базой.
8. Затем я добавил роли для данной базы данных.
9. С помощью `rs.status` я посмотрел какие реплики PREMIER, а какая SECONDARY.
10. Я поронял PREMIER, и затем зоходил на другие и смотрел какие активные. Посмотрел роли в других репликах и увидел что они тоже перенеслись
11. Затем я уронил все, и потом запустил все. И в итоге PREMIER стала та где была выполнена в начале команда `rs.initiate`.

## Результат

- Я запустил реплики.
- Дал специальные конфиги для каждой реплики.
- Сделал шардированный кластер.
- Проверил как меяется главная реплика в зависемости от того кто упал

## Проблемы с которыми я столкнулся

- У меня были запущены все реплики, я решил доделать работу в другой день. И чтобы деньги не тратились я выключил машины. И на следующий день я вижу что у меня реплики mongo не может подключиться друг к другу из-за того что публичный ip поменялся. У меня не получилось использовать команду `rs.reconfig` поэтому мне пришлось стереть базу local, и заного все конфиги проставить. Но благодаря этому я понял что надо использовать внутренний ip, потому что он не меняется и он безопаснее.
